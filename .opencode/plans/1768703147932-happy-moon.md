# Plan: Browser Dropdown Selector

## Goal
Replace browser path TextField with Picker dropdown showing installed Chromium browsers.

## Current State
- `ContentView.swift:55-62`: TextField bound to `viewModel.config.browser`
- `Config.swift:56`: `browser: String` stores path like `/Applications/Helium.app`
- `ConfigViewModel.swift:25-32`: Reacts to browser changes, re-discovers profiles

## Implementation

### 1. Create BrowserDiscovery.swift (new file)

```swift
import AppKit

struct InstalledBrowser: Identifiable, Hashable {
    let url: URL
    let name: String
    var id: URL { url }
    var path: String { url.path }
}

struct BrowserDiscovery {
    private static let chromiumBundleIDs: Set<String> = [
        "com.google.Chrome", "com.google.Chrome.canary",
        "com.brave.Browser", "com.microsoft.edgemac",
        "com.opera.Opera", "org.chromium.Chromium",
        "com.vivaldi.Vivaldi", "com.keksbay.Arc",
        // Add more as needed
    ]
    
    static func chromiumBrowsers() -> [InstalledBrowser] {
        guard let httpURL = URL(string: "http://example.com") else { return [] }
        return NSWorkspace.shared
            .urlsForApplications(toOpen: httpURL)
            .filter { isChromium($0) }
            .map { InstalledBrowser(url: $0, name: displayName($0)) }
    }
    
    private static func isChromium(_ url: URL) -> Bool {
        guard let bundle = Bundle(url: url),
              let id = bundle.bundleIdentifier else { return false }
        return chromiumBundleIDs.contains(id)
    }
    
    private static func displayName(_ url: URL) -> String {
        FileManager.default.displayName(atPath: url.path)
    }
}
```

### 2. Update ConfigViewModel.swift

Add:
```swift
@Published var availableBrowsers: [InstalledBrowser] = []

// In init:
availableBrowsers = BrowserDiscovery.chromiumBrowsers()

// Computed binding for selected browser
var selectedBrowser: Binding<InstalledBrowser?> {
    Binding(
        get: { self.availableBrowsers.first { $0.path == self.config.browser } },
        set: { if let b = $0 { self.config.browser = b.path } }
    )
}

// Check if current browser is valid
var isBrowserValid: Bool {
    availableBrowsers.contains { $0.path == config.browser }
}
```

### 3. Update ContentView.swift

Replace browser TextField (lines 55-62) with:
```swift
HStack {
    Text("Browser")
        .foregroundStyle(.secondary)
    Spacer()
    if viewModel.isBrowserValid {
        Picker("", selection: viewModel.selectedBrowser) {
            ForEach(viewModel.availableBrowsers) { browser in
                Text(browser.name).tag(Optional(browser))
            }
        }
        .frame(maxWidth: 200)
    } else {
        // Warning for invalid/missing browser
        HStack {
            Image(systemName: "exclamationmark.triangle.fill")
                .foregroundStyle(.yellow)
            Text(viewModel.config.browser)
                .foregroundStyle(.secondary)
        }
    }
}
```

## Files
| File | Action |
|------|--------|
| `Switchboard/BrowserDiscovery.swift` | Create |
| `Switchboard/ConfigViewModel.swift` | Modify |
| `Switchboard/ContentView.swift` | Modify |

## Verification
1. `make install`
2. Run app → verify dropdown shows Chromium browsers only
3. Select different browser → verify profile list updates
4. Edit config.json with invalid path → verify warning shown
5. Route URL → verify launches selected browser
